{% if db_txt %}
# Start #
su -s /bin/bash - msausr -c "bash"
PGPASSWORD=wapwap12 psql -U msa
\set ON_ERROR_STOP 1
{% endif %}
{% if afg_psql_database.NAF is defined %}
delete from NAF;
{% for item in afg_psql_database.NAF %}
insert into NAF (fqdn,uasecprotoid,sendimpitonaf,nafipaddress,description) values ('{{item.fqdn}}','{{item.uasecprotoid}}','{{item.sendimpitonaf}}','{{item.nafipaddress}}','{{item.description}}');
{% endfor%}
{% endif%}
delete from DIAMETERPEER;
delete from DIAMETERPEERLIST;
select setval('diameterpeerseq',99);
{% for item in afg_psql_database.Diameter.Peers %}
insert into DIAMETERPEER (diameterpeerseq,peerdisplayname,hostname,address,port,timeout) values (nextval('diameterpeerseq'),'{{item.DisplayName}}','{{item.HostName}}','{{item.IPAddress}}',{{item.Port}},{{item.Timeout}});
{% endfor%}
select setval('diameterpeerlistseq',99);
select setval('diameterrouteseq',99);
{% for item in afg_psql_database.Diameter.Route%}
insert into DIAMETERPEERLIST (diameterpeerlistseq,listname) values (nextval('diameterpeerlistseq'),'list-{{100 + loop.index - 1}}');
insert into DIAMETERPEERLISTMEMBERS (diameterpeerlistid,peer,prio) values ({{100 + loop.index - 1}},100,1);
insert into DIAMETERROUTE (diameterrouteseq,application,realm,peerlist) values (nextval('diameterrouteseq'),{{item.application}},'{{item.Realm}}',{{100 + loop.index - 1}});
{% endfor %}
delete from AUIDXDMSPOOLMAP;
delete from XDMSPOOLMAP;
delete from XDMSPOOLS;
delete from XDMSERVERS;
select setval('xdmserveridseq',99);
{% for item in afg_psql_database.AP.servers %}
INSERT INTO XDMSERVERS (XDMSERVERID, XDMSERVERADDRESS, XDMSERVERPORT, XDMSERVICE) VALUES (nextval('xdmserveridseq'),'{{item.address}}',{{item.port}},'{{item.service}}');
{% endfor%}
select setval('xdmspoolidseq',99);
INSERT INTO XDMSPOOLS (XDMSPOOLID, XDMSPOOLNAME) VALUES (nextval('xdmspoolidseq'),'{{afg_psql_database.AP.pools.name}}');
{% for item in afg_psql_database.AP.servers %}
INSERT INTO XDMSPOOLMAP (XDMSPOOLID, XDMSERVERID, PRIORITY) VALUES (100,{{100 + loop.index - 1}},1);
{% endfor%}
INSERT INTO AUIDXDMSPOOLMAP (AUIDNAME, XDMSPOOLID, USERGROUP) VALUES ('{{afg_psql_database.AP.auids.auid}}',100, '');
{% if db_txt %}
\q
exit
# Done! #
{% endif %}